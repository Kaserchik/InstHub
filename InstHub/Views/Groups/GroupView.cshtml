@using InstHub.Data.Identity
@using Microsoft.AspNetCore.Identity
@model InstHub.Controllers.GroupsController.UserFilesViewModel
@inject SignInManager<AppIdentityUser> SignInManager
@inject UserManager<AppIdentityUser> UserManager
@{
    ViewData["Title"] = ViewData["Title"];
    var id_check = 0;
    if (ViewData["Title"] == "Студенческий состав")
    {
        id_check = 1;
    }
    else if (ViewData["Title"] == "Группа на проект")
    {
        id_check = 2;
    }
    else
    {
        id_check = 3;
    }
}

<div class="group-header">
    <div class="nav-buttons">
        <a asp-controller="" asp-action="" class="nav-button" disabled>Главная</a>
        <a asp-controller="" asp-action="" class="nav-button" disabled>Пользователи</a>
        <a asp-controller="" asp-action="" class="nav-button" disabled>Файлы</a>
    </div>
</div>

<div class="files_div">
    @{
        int fileCount = 0;
    }
    <div class="el_line">
        @if (Model.Files != null && Model.Files.Count > 0)
        {
            @foreach (var file in Model.Files)
            {
                string iconPath;
                string openPath;
                switch (file.Extension)
                {
                    case ".pdf":
                        iconPath = "/images/files/pdf_icon.png";
                        openPath = "";
                        break;
                    case ".vsdx":
                        iconPath = "/images/files/vsdx_icon.png";
                        openPath = "";
                        break;
                    case ".pptx":
                        iconPath = "/images/files/pptx_icon.png";
                        openPath = "";
                        break;
                    case ".wav":
                    case ".midi":
                    case ".mp3":
                        iconPath = "/images/files/mp3.png";
                        openPath = "";
                        break;
                    case ".rar":
                    case ".zip":
                    case ".7z":
                        iconPath = "/images/files/zip.png";
                        openPath = "";
                        break;
                    case ".avi":
                    case ".mp4":
                    case ".mpg":
                        iconPath = "/images/files/mp4.png";
                        openPath = $"~/groups/id3/files/{file.FileName}";
                        break;
                    case ".jpg":
                    case ".jpeg":
                    case ".png":
                    case ".gif":
                        iconPath = @Url.Content($"~/groups/id3/files/{file.FileName}");
                        openPath = $"~/groups/id3/files/{file.FileName}";
                        break;
                    case ".xls":
                    case ".xlsx":
                        iconPath = "/images/files/excel_icon.png";
                        openPath = "";
                        break;
                    case ".txt":
                    case ".docx":
                    case ".doc":
                        iconPath = "/images/files/docx.png";
                        openPath = "";
                        break;
                    default:
                        iconPath = "/images/files/default_icon.png";
                        openPath = "";
                        break;
                }
                <a href="@Url.Content(openPath)" class="bg_file">
                    <div class="bg_file_add">
                        <img src="@iconPath" class="file_ico_class" />
                    </div>
                    <p>@file.FileName</p>
                </a>
                <div class="file_actions">
                    <a asp-controller="Groups" asp-action="Download" asp-route-fileName="@file.FileName" class="file_action" title="Загрузить">
                        <img src="/images/files/download_icon.png" class="dw_dl_file_ico_class" />
                    </a>
                    <a asp-controller="Groups" asp-action="Delete" asp-route-fileName="@file.FileName" class="file_action" title="Удалить">
                        <img src="/images/files/delete_icon.png" class="dw_dl_file_ico_class" />
                    </a>
                </div>

                fileCount++;

                if (fileCount % 5 == 0 && fileCount != 0)
                {
                    @Html.Raw("</div><div class=\"el_line\">") <!-- Закрываем текущий и открываем новый el_line -->
                }
            }
        }
    </div>
    <form id="uploadFileForm" enctype="multipart/form-data" method="post" asp-controller="Groups" asp-action="UploadFile">
        @Html.AntiForgeryToken()
        <input type="file" name="file" id="fileInput" style="display:none;" />
        <a href="#" class="a_bt_add" onclick="document.getElementById('fileInput').click(); return false;">
            <div class="bg_file_add">
                <img src="/images/files/add_file.png" class="file_ico_class" />
            </div>
            <p>Добавить файл</p>
        </a>
    </form>
</div>

@section Scripts {
    <script>
        document.getElementById('fileInput').addEventListener('change', function () {
            if (this.files && this.files.length > 0) {
                document.getElementById('uploadFileForm').submit();
            }
        });
    </script>
}
